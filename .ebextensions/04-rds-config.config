option_settings:
  aws:rds:dbinstance:
    DBInstanceClass: db.t3.micro
    DBEngine: postgres
    DBEngineVersion: '15.4'
    DBAllocatedStorage: '20'
    DBStorageType: gp2
    MultiAZDatabase: false
    DBDeletionPolicy: Delete
    DBInstanceIdentifier: indiantrademart-db
    MasterUsername: postgres
    # MasterUserPassword will be set via console or EB CLI for security

  aws:elasticbeanstalk:application:environment:
    # RDS Connection Configuration
    # These are automatically set when RDS is linked, but can be overridden
    RDS_HOSTNAME: ${RDS_HOSTNAME}
    RDS_PORT: ${RDS_PORT}
    RDS_DB_NAME: ${RDS_DB_NAME}
    RDS_USERNAME: ${RDS_USERNAME}
    RDS_PASSWORD: ${RDS_PASSWORD}
    
    # Spring Boot Database Properties
    SPRING_DATASOURCE_URL: jdbc:postgresql://${RDS_HOSTNAME}:${RDS_PORT}/${RDS_DB_NAME}
    SPRING_DATASOURCE_USERNAME: ${RDS_USERNAME}
    SPRING_DATASOURCE_PASSWORD: ${RDS_PASSWORD}
    SPRING_DATASOURCE_DRIVER_CLASS_NAME: org.postgresql.Driver
    
    # JPA/Hibernate Configuration
    SPRING_JPA_DATABASE_PLATFORM: org.hibernate.dialect.PostgreSQLDialect
    SPRING_JPA_HIBERNATE_DDL_AUTO: update
    SPRING_JPA_SHOW_SQL: false
    SPRING_JPA_PROPERTIES_HIBERNATE_FORMAT_SQL: false
    
    # Connection Pool Configuration
    SPRING_DATASOURCE_HIKARI_MAXIMUM_POOL_SIZE: 10
    SPRING_DATASOURCE_HIKARI_MINIMUM_IDLE: 2
    SPRING_DATASOURCE_HIKARI_CONNECTION_TIMEOUT: 20000
    SPRING_DATASOURCE_HIKARI_IDLE_TIMEOUT: 300000
    SPRING_DATASOURCE_HIKARI_MAX_LIFETIME: 1200000

Resources:
  AWSEBAutoScalingGroup:
    Type: AWS::AutoScaling::AutoScalingGroup
    Properties:
      VPCZoneIdentifier:
        - subnet-12345678
        - subnet-87654321
      HealthCheckType: ELB
      HealthCheckGracePeriod: 600
