option_settings:
  # Java Runtime Configuration
  aws:elasticbeanstalk:container:java:
    Xms: 512m
    Xmx: 1024m
    MaxMetaspaceSize: 256m
    JVMOptions: "-XX:+UseG1GC -XX:MaxGCPauseMillis=200 -XX:+UseStringDeduplication"
  
  # Application Health Check
  aws:elasticbeanstalk:application:
    Application_Healthcheck_URL: /api/actuator/health
  
  # Load Balancer Health Check  
  aws:elasticbeanstalk:environment:process:default:
    HealthCheckPath: /api/actuator/health
    HealthCheckInterval: 30
    HealthyThresholdCount: 2
    UnhealthyThresholdCount: 5
    MatcherHTTPCode: 200
  
  # Rolling Deployments
  aws:elasticbeanstalk:command:
    DeploymentPolicy: RollingWithAdditionalBatch
    BatchSizeType: Percentage
    BatchSize: 50
    Timeout: 600

files:
  "/opt/elasticbeanstalk/tasks/taillogs.d/spring-boot.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      /var/log/web.stdout.log
      /var/log/spring.log

container_commands:
  01_setup_logging:
    command: |
      mkdir -p /var/log
      touch /var/log/spring.log
      chown webapp:webapp /var/log/spring.log
      chmod 664 /var/log/spring.log
