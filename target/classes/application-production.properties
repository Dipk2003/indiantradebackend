# =============================================================================
# iTech Backend - Production Configuration
# =============================================================================
# Environment: PRODUCTION
# Security Level: HIGH
# =============================================================================

spring.profiles.active=production

# =============================================================================
# SERVER CONFIGURATION - Production Optimized
# =============================================================================
server.port=${PORT:8080}
server.address=0.0.0.0
server.servlet.context-path=${CONTEXT_PATH:}
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json,application/xml
server.compression.min-response-size=1024
server.tomcat.max-threads=200
server.tomcat.min-spare-threads=10
server.tomcat.connection-timeout=20000
server.tomcat.max-connections=8192

# =============================================================================
# DATABASE CONFIGURATION - Production
# =============================================================================
spring.datasource.url=${DATABASE_URL}
spring.datasource.driver-class-name=${DB_DRIVER:com.mysql.cj.jdbc.Driver}
spring.jpa.properties.hibernate.dialect=${DB_DIALECT:org.hibernate.dialect.MySQLDialect}
spring.datasource.username=${JDBC_DATABASE_USERNAME}
spring.datasource.password=${JDBC_DATABASE_PASSWORD}

# =============================================================================
# JPA & HIBERNATE CONFIGURATION - Production
# =============================================================================
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.generate_statistics=true
spring.jpa.properties.hibernate.cache.use_second_level_cache=true
spring.jpa.properties.hibernate.cache.region.factory_class=org.hibernate.cache.jcache.JCacheRegionFactory
spring.jpa.properties.hibernate.jdbc.batch_size=25
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# =============================================================================
# CONNECTION POOL CONFIGURATION - Production Optimized
# =============================================================================
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.maximum-pool-size=50
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1200000
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.leak-detection-threshold=60000
spring.datasource.hikari.pool-name=HikariPool-iTech-Production

# =============================================================================
# REDIS CONFIGURATION - Production
# =============================================================================
spring.redis.host=${REDIS_HOST}
spring.redis.port=${REDIS_PORT:6379}
spring.redis.password=${REDIS_PASSWORD}
spring.redis.timeout=3000ms
spring.redis.lettuce.pool.max-active=20
spring.redis.lettuce.pool.max-idle=10
spring.redis.lettuce.pool.min-idle=5
spring.redis.lettuce.pool.max-wait=-1ms
spring.cache.redis.time-to-live=600000

# =============================================================================
# CORS CONFIGURATION - Production
# =============================================================================
spring.web.cors.allowed-origins=${CORS_ALLOWED_ORIGINS}
spring.web.cors.allowed-methods=GET,POST,PUT,DELETE,PATCH,OPTIONS
spring.web.cors.allowed-headers=Authorization,Content-Type,X-Requested-With,X-Subdomain,Accept,Origin,Access-Control-Request-Method,Access-Control-Request-Headers
spring.web.cors.allow-credentials=true
spring.web.cors.max-age=3600

# =============================================================================
# SUBDOMAIN CONFIGURATION - Production
# =============================================================================
app.subdomain.enabled=true
app.subdomain.base-domain=${BASE_DOMAIN}
app.subdomain.default-subdomain=www
app.subdomain.ssl-enabled=true

# =============================================================================
# JWT CONFIGURATION - Production Security
# =============================================================================
jwt.secret=${JWT_SECRET}
jwt.expiration-in-ms=${JWT_EXPIRATION:3600000}
jwt.refresh-expiration-in-ms=${JWT_REFRESH_EXPIRATION:604800000}
jwt.issuer=${JWT_ISSUER:iTech-Backend}
jwt.audience=${JWT_AUDIENCE:iTech-Users}

# =============================================================================
# LOGGING CONFIGURATION - Production
# =============================================================================
logging.level.com.itech.itech_backend=INFO
logging.level.org.springframework.security=WARN
logging.level.org.springframework.web=WARN
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN
logging.level.root=INFO
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
logging.file.name=logs/itech-backend.log
logging.file.max-size=10MB
logging.file.max-history=30

# =============================================================================
# ACTUATOR & MONITORING - Production
# =============================================================================
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=when-authorized
management.metrics.export.prometheus.enabled=true
management.health.redis.enabled=true
management.health.diskspace.enabled=true
management.health.db.enabled=true
management.server.port=${MANAGEMENT_PORT:8081}
management.security.enabled=true

# =============================================================================
# EXTERNAL SERVICE CONFIGURATION - Production
# =============================================================================
razorpay.key.id=${RAZORPAY_KEY_ID}
razorpay.key.secret=${RAZORPAY_KEY_SECRET}
razorpay.webhook.secret=${RAZORPAY_WEBHOOK_SECRET}
razorpay.currency=INR

# GST Verification - Production
gst.verification.enabled=${GST_VERIFICATION_ENABLED:true}
gst.api.url=${GST_API_URL}
gst.api.key=${GST_API_KEY}

# PAN Verification - Production
pan.verification.enabled=${PAN_VERIFICATION_ENABLED:true}
pan.api.url=${PAN_API_URL}
pan.api.key=${PAN_API_KEY}

# OpenAI Configuration - Production
openai.api.key=${OPENAI_API_KEY}
openai.api.url=${OPENAI_API_URL:https://api.openai.com/v1}

# =============================================================================
# FLYWAY CONFIGURATION - Production
# =============================================================================
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=false
spring.flyway.baseline-version=1
spring.flyway.locations=classpath:db/migration
spring.flyway.validate-on-migrate=true
spring.flyway.out-of-order=false
spring.flyway.clean-disabled=true

# =============================================================================
# PRODUCTION SETTINGS - STRICT SECURITY
# =============================================================================
email.simulation.enabled=false
sms.simulation.enabled=false
payment.simulation.enabled=false

# PRODUCTION DEPLOYMENT CONFIGURATION
spring.application.name=itech-backend

# Server Configuration
server.port=${PORT:8080}

# Database Configuration for AWS RDS PostgreSQL
spring.datasource.url=${DATABASE_URL:jdbc:postgresql://localhost:5432/itech_db}
spring.datasource.username=${JDBC_DATABASE_USERNAME:postgres}
spring.datasource.password=${JDBC_DATABASE_PASSWORD:password}
spring.datasource.driver-class-name=org.postgresql.Driver
spring.datasource.hikari.maximum-pool-size=5
spring.datasource.hikari.minimum-idle=1
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.idle-timeout=300000

# JPA Settings - Optimized for production
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.jdbc.time_zone=UTC
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.globally_quoted_identifiers=true

# Disable Flyway and schema initialization
spring.flyway.enabled=false
spring.sql.init.mode=never
spring.jpa.defer-datasource-initialization=false

# JWT Configuration
jwt.secret=${JWT_SECRET}
jwt.expiration-in-ms=${JWT_EXPIRATION:86400000}

# CORS Configuration
spring.web.cors.allowed-origins=${ALLOWED_ORIGINS}
spring.web.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
spring.web.cors.allowed-headers=*
spring.web.cors.allow-credentials=true

# Email Configuration - Production Gmail SMTP
spring.mail.host=${SPRING_MAIL_HOST:smtp.gmail.com}
spring.mail.port=${SPRING_MAIL_PORT:587}
spring.mail.username=${SPRING_MAIL_USERNAME}
spring.mail.password=${SPRING_MAIL_PASSWORD}
spring.mail.properties.mail.smtp.auth=${SPRING_MAIL_PROPERTIES_MAIL_SMTP_AUTH:true}
spring.mail.properties.mail.smtp.starttls.enable=${SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE:true}
spring.mail.properties.mail.smtp.starttls.required=${SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_REQUIRED:true}
spring.mail.properties.mail.smtp.ssl.protocols=${SPRING_MAIL_PROPERTIES_MAIL_SMTP_SSL_PROTOCOLS:TLSv1.2}
spring.mail.properties.mail.smtp.connectiontimeout=30000
spring.mail.properties.mail.smtp.timeout=30000
spring.mail.properties.mail.smtp.writetimeout=30000
spring.mail.properties.mail.debug=${MAIL_DEBUG:false}

# Application settings - Production email configuration
email.simulation.enabled=${EMAIL_SIMULATION_ENABLED:false}
sms.simulation.enabled=${SMS_SIMULATION_ENABLED:true}

# Logging Configuration - Enable debugging for email issues
logging.level.com.itech.itech_backend=DEBUG
logging.level.org.springframework.web=INFO
logging.level.org.hibernate=WARN
logging.level.com.zaxxer.hikari=INFO
logging.level.org.springframework.boot.autoconfigure.jdbc=INFO
logging.level.org.springframework.mail=DEBUG
logging.level.jakarta.mail=DEBUG
logging.level.root=INFO

# Server optimizations
server.tomcat.connection-timeout=20000
server.tomcat.keep-alive-timeout=20000
server.tomcat.max-connections=8192
server.tomcat.accept-count=100
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=10

# Management endpoints
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=when-authorized
management.endpoints.web.base-path=/actuator
