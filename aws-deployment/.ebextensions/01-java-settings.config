option_settings:
  # Java Platform Configuration
  aws:elasticbeanstalk:container:java:
    Xms: 512m
    Xmx: 2048m
    MaxPermSize: 256m
    JVMOptions: "-Dspring.profiles.active=aws-production -Djava.awt.headless=true -Dfile.encoding=UTF-8"
    
  # Application Load Balancer Configuration
  aws:elasticbeanstalk:environment:
    LoadBalancerType: application
    ServiceRole: aws-elasticbeanstalk-service-role
    
  # Auto Scaling Configuration
  aws:autoscaling:asg:
    MinSize: 2
    MaxSize: 10
    Cooldown: 300
    
  aws:autoscaling:launchconfiguration:
    InstanceType: t3.medium
    IamInstanceProfile: aws-elasticbeanstalk-ec2-role
    SecurityGroups: "sg-backend"
    
  # Load Balancer Health Check
  aws:elasticbeanstalk:healthreporting:system:
    SystemType: enhanced
    HealthCheckSuccessThreshold: Ok
    
  aws:elbv2:loadbalancer:
    IdleTimeout: 60
    
  aws:elbv2:listener:80:
    Protocol: HTTP
    Rules: default
    
  aws:elbv2:listener:443:
    Protocol: HTTPS
    SSLCertificateArns: "arn:aws:acm:ap-south-1:ACCOUNT_ID:certificate/CERTIFICATE_ID"
    Rules: default
    
  # Environment Variables
  aws:elasticbeanstalk:application:environment:
    SPRING_PROFILES_ACTIVE: "aws-production"
    SERVER_PORT: "8080"
    
  # VPC Configuration
  aws:ec2:vpc:
    VPCId: vpc-xxxxxxxxx
    Subnets: "subnet-xxxxxxxxx,subnet-yyyyyyyyy"
    ELBSubnets: "subnet-xxxxxxxxx,subnet-yyyyyyyyy"
    ELBScheme: internet-facing
    DBSubnets: "subnet-aaaaaaaa,subnet-bbbbbbbb"
    
commands:
  01_setup_timezone:
    command: "timedatectl set-timezone Asia/Kolkata"
    
  02_install_cloudwatch_agent:
    command: |
      wget https://s3.amazonaws.com/amazoncloudwatch-agent/amazon_linux/amd64/latest/amazon-cloudwatch-agent.rpm
      rpm -U ./amazon-cloudwatch-agent.rpm
