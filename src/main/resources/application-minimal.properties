# =============================================================================
# iTech Backend - Ultra Minimal Configuration for 512MB Render Deployment
# =============================================================================
# This is an extreme memory optimization profile
# =============================================================================

# =============================================================================
# SERVER CONFIGURATION - MINIMAL
# =============================================================================
server.port=${PORT:8080}
server.address=0.0.0.0
server.servlet.context-path=
server.compression.enabled=false

# Ultra-minimal Tomcat settings
server.tomcat.threads.max=5
server.tomcat.threads.min-spare=1
server.tomcat.accept-count=3
server.tomcat.max-connections=25

# =============================================================================
# DATABASE CONFIGURATION - MINIMAL
# =============================================================================
spring.datasource.url=jdbc:postgresql://dpg-d2val5vdiees73du2i4g-a.oregon-postgres.render.com/helloji_mufl
spring.datasource.username=${JDBC_DATABASE_USERNAME:postgres}
spring.datasource.password=${JDBC_DATABASE_PASSWORD:postgres}
spring.datasource.driver-class-name=org.postgresql.Driver

# Minimal connection pool
spring.datasource.hikari.minimum-idle=1
spring.datasource.hikari.maximum-pool-size=2
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.leak-detection-threshold=0

# =============================================================================
# JPA CONFIGURATION - MINIMAL
# =============================================================================
# PostgreSQL dialect is auto-detected, no need to specify
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.open-in-view=false

# No caching at all
spring.cache.type=none
spring.jpa.properties.hibernate.cache.use_second_level_cache=false
spring.jpa.properties.hibernate.cache.use_query_cache=false

# =============================================================================
# LOGGING - MINIMAL
# =============================================================================
logging.level.root=WARN
logging.level.com.itech.itech_backend=INFO
logging.level.org.springframework=WARN
logging.level.org.hibernate=WARN
spring.main.banner-mode=off

# =============================================================================
# ACTUATOR - HEALTH ONLY
# =============================================================================
management.endpoints.web.exposure.include=health
management.endpoint.health.show-details=never

# =============================================================================
# CORS - BASIC
# =============================================================================
spring.web.cors.allowed-origins=${ALLOWED_ORIGINS:*}
spring.web.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
spring.web.cors.allowed-headers=*
spring.web.cors.allow-credentials=true

# =============================================================================
# JWT - BASIC
# =============================================================================
jwt.secret=${JWT_SECRET:minimal-secret-for-render}
jwt.expiration-in-ms=3600000

# =============================================================================
# EXTREME MEMORY OPTIMIZATIONS
# =============================================================================
spring.main.lazy-initialization=true
spring.jmx.enabled=false
spring.sql.init.mode=never
spring.jpa.defer-datasource-initialization=true

# Disable almost everything
spring.autoconfigure.exclude=\
org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\
org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration,\
org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration,\
org.springframework.boot.autoconfigure.data.redis.RedisReactiveAutoConfiguration,\
org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration,\
org.springframework.boot.actuate.autoconfigure.metrics.MetricsAutoConfiguration,\
org.springframework.boot.actuate.autoconfigure.metrics.export.prometheus.PrometheusMetricsExportAutoConfiguration,\
org.springframework.boot.autoconfigure.websocket.servlet.WebSocketServletAutoConfiguration,\
org.springframework.boot.autoconfigure.mail.MailSenderAutoConfiguration,\
org.springframework.boot.actuate.autoconfigure.audit.AuditAutoConfiguration,\
org.springframework.boot.autoconfigure.task.TaskExecutionAutoConfiguration,\
org.springframework.boot.autoconfigure.task.TaskSchedulingAutoConfiguration
